<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SJ Auto Â· æŸ¥è¯¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{ extend:{
        colors:{ sjgold:'#FFD700' },
        boxShadow: {
          soft: '0 6px 24px rgba(255,215,0,0.08), 0 2px 8px rgba(0,0,0,0.25)'
        }
      } }
    }
  </script>
</head>
<body class="min-h-screen bg-black text-sjgold/90 antialiased">
  <!-- é¡¶éƒ¨æ  -->
  <header class="sticky top-0 z-10 bg-black/70 backdrop-blur border-b border-sjgold/20">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-sjgold/10 ring-1 ring-sjgold/20">ğŸ“Š</span>
        <h1 class="text-lg sm:text-xl font-semibold tracking-wide">æŸ¥è¯¢ Â· è´¹ç”¨ & ç…§ç‰‡</h1>
      </div>
      <nav class="text-sm flex gap-3">
        <a href="index.html" class="px-3 py-1.5 rounded-lg border border-sjgold/30 hover:bg-zinc-900">å½•å…¥</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
    <!-- é¡¶éƒ¨åˆ‡æ¢ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 bg-neutral-950/70 rounded-2xl ring-1 ring-sjgold/20 p-3.5">
        <div class="flex items-center gap-2">
          <button id="tabByDate" class="px-4 h-10 rounded-xl border border-sjgold/30 bg-sjgold text-black font-medium shadow-soft">æŒ‰æ—¥æœŸ</button>
          <button id="tabByCar"  class="px-4 h-10 rounded-xl border border-sjgold/30 hover:bg-zinc-900">æŒ‰è½¦å‹</button>
          <span class="text-xs opacity-70 ml-auto">å°æç¤ºï¼šç‚¹å‡»å›¾ç‰‡å¯åœ¨æ–°æ ‡ç­¾æ‰“å¼€åŸå›¾</span>
        </div>
      </div>
      <!-- æœç´¢æ¡†ï¼ˆè½¦å‹æ¨¡å¼çš„å°è¿‡æ»¤ï¼‰ -->
      <div class="bg-neutral-950/70 rounded-2xl ring-1 ring-sjgold/20 p-3.5">
        <div class="flex items-center gap-2">
          <span class="text-xs opacity-70">å¿«é€Ÿç­›è½¦</span>
          <input id="quickCarFilter" placeholder="è¾“å…¥ Stock / Make / Model..."
                 class="flex-1 rounded-lg bg-black/60 border border-sjgold/30 px-3 py-2 outline-none focus:ring-2 focus:ring-yellow-500 text-sm"/>
        </div>
      </div>
    </div>

    <!-- ================= æ¨¡å¼ Aï¼šæŒ‰æ—¥æœŸ ================= -->
    <section id="panelDate" class="bg-neutral-950/70 rounded-2xl ring-1 ring-sjgold/20 p-5 space-y-5">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <div class="lg:col-span-2">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm opacity-80">é€‰æ‹©æ—¥æœŸï¼ˆæ¥è‡ª Sheet4 è¡¨å¤´ï¼‰</div>
            <div class="flex items-center gap-2">
              <button id="calPrevA" type="button" class="px-3 py-1.5 rounded-lg border border-sjgold/30 hover:bg-zinc-900">â†</button>
              <div id="calTitleA" class="text-sm font-semibold"></div>
              <button id="calNextA" type="button" class="px-3 py-1.5 rounded-lg border border-sjgold/30 hover:bg-zinc-900">â†’</button>
            </div>
          </div>
          <div class="grid grid-cols-7 text-xs opacity-70 mb-1">
            <div class="text-center py-1">Mon</div><div class="text-center py-1">Tue</div><div class="text-center py-1">Wed</div>
            <div class="text-center py-1">Thu</div><div class="text-center py-1">Fri</div><div class="text-center py-1">Sat</div><div class="text-center py-1">Sun</div>
          </div>
          <div id="calGridA" class="grid grid-cols-7 gap-1"></div>
          <input id="dateHdrRawA" type="hidden" />
          <p id="calHintA" class="text-xs opacity-70 mt-1"></p>
        </div>
        <div class="bg-black/40 rounded-xl ring-1 ring-sjgold/20 p-3">
          <div class="space-y-3">
            <label class="block text-sm">è´¹ç”¨ç±»åˆ«ç­›é€‰</label>
            <select id="catFilterA" class="w-full rounded-lg bg-black/60 border border-sjgold/30 px-3 py-2 outline-none">
              <option value="">ï¼ˆå…¨éƒ¨ï¼‰</option>
              <option>ç¨å‰ä¹°å…¥é‡‘é¢</option>
              <option>ä¹°æ–­é‡‘é¢ï¼ˆleaseï¼‰</option>
              <option>è½¦ä¸»è¯è¿‡æˆ·è´¹ç”¨</option>
              <option>è½¬leaseè´¹ç”¨/ä¹°æ–­è´¹ç”¨</option>
              <option>æ£€ä¿®è´¹ç”¨</option>
              <option>åŠ æ²¹è´¹ç”¨</option>
              <option>ä¸Šç‰Œè´¹ç”¨</option>
              <option>é“¶è¡Œæ‰‹ç»­è´¹</option>
              <option>å®¢æˆ·è¿”ä½£</option>
              <option>ä¸­ä»‹è¿”ä½£</option>
              <option>å‘˜å·¥æ¿€åŠ±</option>
            </select>
            <button id="btnLoadA" class="w-full h-10 rounded-lg bg-sjgold text-black font-semibold hover:brightness-95">åŠ è½½</button>
            <div id="msgA" class="text-xs opacity-80"></div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        <div>
          <div class="text-sm mb-2 opacity-80">è®°å½•</div>
          <div id="listA" class="space-y-2"></div>
        </div>
        <div>
          <div class="text-sm mb-2 opacity-80">å›¾ç‰‡</div>
          <div id="picsA" class="grid grid-cols-2 sm:grid-cols-3 xl:grid-cols-4 gap-2"></div>
        </div>
      </div>
    </section>

    <!-- ================= æ¨¡å¼ Bï¼šæŒ‰è½¦å‹ ================= -->
    <section id="panelCar" class="hidden bg-neutral-950/70 rounded-2xl ring-1 ring-sjgold/20 p-5 space-y-5">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm mb-1">é€‰æ‹©è½¦å‹ï¼ˆæ¥è‡ª Sheet5ï¼‰</label>
            <select id="carSelectB" class="w-full rounded-lg bg-black/60 border border-sjgold/30 px-3 py-2 outline-none"></select>
          </div>
          <div class="flex items-end gap-2">
            <button id="btnLoadB" class="px-5 h-10 rounded-lg bg-sjgold text-black font-semibold hover:brightness-95">åŠ è½½</button>
            <span id="msgB" class="text-sm opacity-80"></span>
          </div>
        </div>
        <div class="bg-black/40 rounded-xl ring-1 ring-sjgold/20 p-3">
          <div class="text-xs opacity-75">æç¤ºï¼šå³ä¾§æ˜¾ç¤ºè¯¥è½¦å‹æ‰€æœ‰ç…§ç‰‡ï¼›å·¦ä¾§åˆ—å‡ºè¯¥è½¦åœ¨ Sheet4 çš„æ¯æ¡è´¹ç”¨è®°å½•ã€‚</div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        <div>
          <div class="text-sm mb-2 opacity-80">è¯¥è½¦è´¹ç”¨è®°å½•ï¼ˆå…¨éƒ¨æ—¥æœŸï¼‰</div>
          <div id="listB" class="space-y-2"></div>
        </div>
        <div>
          <div class="text-sm mb-2 opacity-80">è¯¥è½¦æ‰€æœ‰ç…§ç‰‡</div>
          <div id="picsB" class="grid grid-cols-2 sm:grid-cols-3 xl:grid-cols-4 gap-2"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const BACKEND = 'https://flameauto-write.onrender.com';
    const CLOUDINARY_CLOUD_NAME = 'duwckagtg';

    async function cloudSearchByExpr(expr, limit = 100) {
      const url = `${BACKEND}/cloudinary-search?expr=${encodeURIComponent(expr)}&limit=${limit}`;
      const r = await fetch(url);
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error || `HTTP ${r.status}`);
      return j;
    }

    /* ---- æ—¥æœŸæ¨¡å¼ loadByDate ä¿®æ”¹ ---- */
    async function loadByDate(){
      const hdr = document.getElementById('dateHdrRawA').value;
      const pics= document.getElementById('picsA');
      const list= document.getElementById('listA');
      const msg = document.getElementById('msgA');
      list.innerHTML = ''; pics.innerHTML = ''; msg.textContent = '';
      if(!hdr){ msg.textContent='è¯·é€‰æ‹©æ—¥æœŸ'; return; }

      const dateISO = hdr; // ä½ å·²æœ‰è½¬æ¢å‡½æ•°å¯ç”¨
      // ğŸ‘‰ æ”¹æˆå†’å·+å¼•å·çš„ Cloudinary è¡¨è¾¾å¼
      const exprForDate = `public_id:*__${dateISO}__*`;

      try{
        const res = await cloudSearchByExpr(exprForDate);
        pics.innerHTML = '';
        (res.resources || []).forEach(img=>{
          const url = `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload/c_fill,w_500,h_350,q_auto,f_auto/${img.public_id}.jpg`;
          const el = document.createElement('img');
          el.src = url;
          el.alt = img.public_id;
          el.className = 'w-full h-28 object-cover rounded-lg border border-sjgold/20';
          pics.appendChild(el);
        });
      }catch(e){ msg.textContent='å›¾ç‰‡åŠ è½½å¤±è´¥'; }
    }

    /* ---- è½¦å‹æ¨¡å¼ loadByCar ä¿®æ”¹ ---- */
    async function loadByCar(){
      const selVal = document.getElementById('carSelectB').value;
      const pics= document.getElementById('picsB');
      const msg = document.getElementById('msgB');
      pics.innerHTML=''; msg.textContent='';
      if(!selVal){ msg.textContent='è¯·é€‰æ‹©è½¦å‹'; return; }
      const car = JSON.parse(selVal);

      // ğŸ‘‰ æ”¹æˆå†’å·+å¼•å·
      const prefix  = `${car.stock}_${car.year}_${car.make}_${car.model}__`;
      const expr = `public_id:"${prefix}*"`;

      try{
        const res = await cloudSearchByExpr(expr);
        (res.resources || []).forEach(img=>{
          const url = `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload/c_fill,w_500,h_350,q_auto,f_auto/${img.public_id}.jpg`;
          const el = document.createElement('img');
          el.src = url;
          el.alt = img.public_id;
          el.className = 'w-full h-28 object-cover rounded-lg border border-sjgold/20';
          pics.appendChild(el);
        });
      }catch(e){ msg.textContent='å›¾ç‰‡åŠ è½½å¤±è´¥'; }
    }
  </script>
</body>
</html>
